---
import { EXPERIENCE } from "../data/experience";
import Button from "./Button.astro";

const highlightKeywords = (text: string, keywords: string[]): string => {
    let highlightedText = text;

    keywords.forEach((keyword) => {
        const parts = highlightedText.split(keyword); // Divide el texto en partes
        highlightedText = parts.join(`<span style="color:#b47eff;font-weight:bold;">${keyword}</span>`); // Une las partes resaltando la palabra clave
    });

    return highlightedText;
};
---

<section class="pl-10 border-l border-white/40 mt-10">
    <div class="flex flex-col gap-12">
        {
            EXPERIENCE.map(({ id, position, company, dateStart, dateEnd, description, keywords, skills }) => {
                return (
                    <div class="p-10 bg-secondary/5 border-secondary/50 border rounded-xl relative">
                        <div class="flex gap-3 items-center text-[22px] font-bold job-title before:bg-accent ">
                            <span>{position}</span>
                            <span class="size-[5px] bg-secondary/50 rounded-full" />
                            <span class="text-primary">{company}</span>
                        </div>
                        <div class="text-white/50">
                            {dateStart} - {dateEnd}
                        </div>
                        <ul class="flex flex-col gap-[25px] my-[25px] text-text pl-8">
                            {description.map((desc) => {
                                return <li set:html={highlightKeywords(desc, keywords)} />;
                            })}
                        </ul>
                        <div class="flex gap-[15px] flex-wrap">
                            {skills.map(({ id, name }) => {
                                return (
                                    <div class="flex gap-[5px] border border-secondary/35 cursor-default select-none rounded-2xl px-[10px] py-1 text-sm">
                                        <img class="w-4" src={`/svg/${id}.svg`} alt={`${name} icon`} />
                                        <span>{name}</span>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            })
        }
    </div>
    <div class="flex w-full gap-5 mt-12">
        <Button content="Download Resume" url="#download" />
        <img class="p-[10px] bg-primary/20 rounded-xl w-[52px]" src="/svg/linkedin.svg" alt="Linkedin Icon" />
        <img class="p-[10px] bg-primary/20 rounded-xl w-[52px]" src="/svg/github.svg" alt="Github Icon" />
    </div>
</section>

<style>
    .job-title::before {
        content: "";
        width: 18px;
        height: 18px;
        border-radius: 50px;
        position: absolute;
        left: -50px;
        display: block;
    }
    ul li {
        position: relative;
    }
    ul li::before {
        content: "";
        position: absolute;
        left: -30px;
        top: 8px;
        /* transform: translate(-50%, -50%); */
        width: 0;
        height: 0;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
        border-left: 10px solid #b47eff;
    }
    ul li span.highlight {
        color: #b47eff;
        font-weight: bold;
    }
</style>
